<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marlin Configurator - Start Here</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="/start-here">Start Here</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/configurator">Configurator</a>
            </li>
        </ul>
        <h1>Start Here: Marlin Configurator Objectives</h1>
        <div class="mb-3">
            <label for="objectiveSelect" class="form-label fw-bold">Select your objective:</label>
            <select id="objectiveSelect" class="form-select w-auto" onchange="showFlashCard()">
                <option value="">-- Select --</option>
                {% for card in flash_cards %}
                    <option value="{{ card.id }}">{{ card.objective }}</option>
                {% endfor %}
            </select>
        </div>
        <div id="flashCardArea" class="mt-4"></div>
    </div>

    <script>
    const flashCards = {{ flash_cards|tojson | safe }};
    let carriedCard = null;
    function showFlashCard() {
        const select = document.getElementById('objectiveSelect');
        const cardId = select.value;
        const area = document.getElementById('flashCardArea');
        if (!cardId) {
            area.innerHTML = '';
            return;
        }
        const card = flashCards.find(c => c.id === cardId);
        if (!card) {
            area.innerHTML = '<div class="alert alert-warning">No help available for this objective.</div>';
            return;
        }
        let html = renderFlashCard(card, true);
        area.innerHTML = html;
    }
    function renderFlashCard(card, showCarryButton) {
        let html = '<div class="card shadow"><div class="card-body">';
        if (card.objective) html += `<h3 class="card-title">${card.objective}</h3>`;
        if (card.description) html += `<p class="card-text">${card.description}</p>`;
        if (card.keywords && card.keywords.length) html += `<div><strong>Recommended keywords:</strong> <code>${card.keywords.join(', ')}</code></div>`;
        if (card.instructions && card.instructions.length) {
            html += '<div class="mt-2"><strong>Instructions:</strong><ol>';
            for (let step of card.instructions) html += `<li>${step}</li>`;
            html += '</ol></div>';
        }
        if (card.related_settings && card.related_settings.length) html += `<div class="mt-2"><strong>Related settings:</strong> <code>${card.related_settings.join(', ')}</code></div>`;
        if (card.docs_link) html += `<div class="mt-2"><a href="${card.docs_link}" target="_blank" class="btn btn-link">Marlin Documentation</a></div>`;
        if (card.warnings) html += `<div class="mt-2 text-danger"><strong>Warning:</strong> ${card.warnings}</div>`;
        if (showCarryButton) {
            html += '<div class="mt-3"><button class="btn btn-primary" onclick="takeFlashCard()">Carry to Configurator</button></div>';
        }
        html += '</div></div>';
        return html;
    }
    function takeFlashCard() {
        const select = document.getElementById('objectiveSelect');
        const cardId = select.value;
        carriedCard = flashCards.find(c => c.id === cardId);
        if (carriedCard) {
            localStorage.setItem('carriedFlashCard', JSON.stringify(carriedCard));
            if (typeof openFlashCardPopup === 'function') {
                openFlashCardPopup(carriedCard);
            }
        }
    }
    </script>
    <script src="/static/popup.js"></script>
</body>
</html>
